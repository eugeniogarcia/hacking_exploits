//Envia un mensaje
int send_string(int sockfd, unsigned char *buffer)
{
    int sent_bytes, bytes_to_send;
    bytes_to_send = strlen(buffer);
    //Mientras queden caracteres por enviar
    while (bytes_to_send > 0)
    {
        //Envia caracteres
        sent_bytes = send(sockfd, buffer, bytes_to_send, 0);
        if (sent_bytes == -1)
            return 0; // Return 0 on send error.
        
        bytes_to_send -= sent_bytes;
        //Cambia el puntero de sitio, para que apunte siempre al primer caracter no enviado aún.
        buffer += sent_bytes;
    }
    return 1; // Return 1 on success.
}

/* Recibe un mensaje
* This function accepts a socket FD and a ptr to a destination
* buffer. It will receive from the socket until the EOL byte
* sequence in seen. The EOL bytes are read from the socket, but
* the destination buffer is terminated before these bytes.
* Returns the size of the read line (without EOL bytes).
*/
int recv_line(int sockfd, unsigned char *dest_buffer)
{
    //Secuencia de terminación. Estos caracteres determinan el final de un mensaje
    #define EOL "\r\n" // End-of-line byte sequence
    #define EOL_SIZE 2

    unsigned char *ptr;
    int eol_matched = 0;

    ptr = dest_buffer;

    while (recv(sockfd, ptr, 1, 0) == 1) // Recibe un byte cada vez 
    { 
        //Comprueba si los bytes que recibimos siguen la secuencia que define la terminación de un mensaje
        if (*ptr == EOL[eol_matched])
        { // Does this byte match terminator?
            eol_matched++;
            if (eol_matched == EOL_SIZE)
            {                                 
                // Hemos recibido la secuencia que determina el fin de un mensaje. Quitamos de la información recibida la secuencia de terminación
                *(ptr + 1 - EOL_SIZE) = '\0'; // terminate the string.
                return strlen(dest_buffer);   // Return bytes received
            }
        }
        else
        {
            eol_matched = 0;
        }
        ptr++; // Increment the pointer to the next byter.
    }
    return 0; // Didn't find the end-of-line characters.
}