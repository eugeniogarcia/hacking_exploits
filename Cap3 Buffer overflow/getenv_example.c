#include <stdio.h>
#include <stdlib.h>
#include <strings.h>

void imprime(char *mensaje,int);
void contenido(unsigned char *mensaje, int largo);

int main(int argc, char *argv[])
{
    char defecto[]="MIVAR";
    char *mensaje;
    int largo = 64;
    if (argc>1){
        mensaje = argv[1];
    }
    else{
        mensaje = defecto;
    }
    
    if(argc>2){
        largo = atoi(argv[2]);
    }

    //Las variables de entorno se guardan tambien en el stack. Obtenemos en que direccion esta guardada una determinada variable de entorno
    printf("%s is at %p\n%s\n", mensaje, getenv(mensaje), getenv(mensaje));
    imprime(getenv(mensaje),largo);
}


void imprime(char *mensaje,int largo)
{
    char buffer[largo];
    if (!mensaje)return;

    printf("Mensaje: %p\n", buffer);
    memcpy(buffer, mensaje, largo);
    contenido(buffer, largo);
    return;
}

void contenido(unsigned char *mensaje, int largo)
{
    printf("Mensaje(%d):\n", largo);
    for (int i = 0; i < largo; i++)
    {
        printf("%02x ", mensaje[i]);
        if (i % 16 == 15) // Print a newline every 16 bytes.
            printf("\n");
    }
    printf("\n");
    return;
}